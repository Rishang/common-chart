version: 3

tasks:
  docs:
    dir: web
    cmds:
    - pnpm start
  
  docs:build:
    dir: web
    cmds:
    - pnpm install
    - pnpm build

  helm-package-index:
    desc: Package Helm charts and update repository index
    cmds:
    - echo "Adding required Helm repositories..."
    - helm repo add grafana https://grafana.github.io/helm-charts || true
    - helm repo add prometheus-community https://prometheus-community.github.io/helm-charts || true
    - helm repo update
    - echo "Creating charts directory..."
    - mkdir -p web/static/charts
    - echo "Cleaning old chart packages..."
    - rm -f web/static/charts/*.tgz
    - |
      for chart in component-chart loki-stack; do
        cp charts/.helmignore "charts/$chart/.helmignore"
        echo "Copied .helmignore to charts/$chart/.helmignore"
        echo "Packaging $chart..."
        helm dependency update "charts/$chart"
        helm package "charts/$chart" -d web/static/charts/
        echo "Packaged $chart to web/static/charts/"
      done
    - echo "Updating Helm repository index..."
    - helm repo index web/static/charts --url https://rishang.github.io/helm-chart/charts
    - echo "âœ… Charts packaged successfully!"
    - echo "ðŸ“¦ Files created in web/static/charts/"
    - ls -lh web/static/charts/

